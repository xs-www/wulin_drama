# 武林戏项目 - 功能模块总结

## 一、项目概述

武林戏（wulin_drama）是一个武侠主题的游戏开发项目，包含：
1. **自走棋战斗模拟器**（自走棋策划/py灰盒）
2. **武侠故事文档管理**（mjyl目录）

本文档重点整理自走棋模拟器的 TODO 功能模块。

---

## 二、代码中的 TODO 清单（4个）

### 1. 角色属性更新系统 📍 entity.py:81

**当前状态**：空函数实现
```python
def updateInGameAttrs(self):
    pass
```

**功能说明**：
- 根据装备、Buff、羁绊动态更新角色战斗属性
- 影响攻击力、生命值、速度等核心数值

**重要性**：⭐⭐⭐⭐⭐（高优先级）
- 装备系统依赖此功能
- 羁绊系统依赖此功能
- Buff效果需要通过此功能应用

---

### 2. 装备系统 📍 entity.py:167

**当前状态**：空类实现
```python
class Equipment:
    def __init__(self):
        pass
```

**功能说明**：
- 实现武器、护甲、饰品三个装备槽
- 提供属性加成和特殊效果
- 角色类已预留装备字典：`equipments: {"weapon": None, "armor": None, "accessory": None}`

**重要性**：⭐⭐⭐⭐（中高优先级）
- 已在开发路线图中
- 可增加游戏策略深度

**需要实现**：
- 装备属性定义（攻击、防御、特效）
- 装备穿戴/卸下逻辑
- 装备约束检查（如武器类型限制）
- 装备效果应用

---

### 3. 回合管理器 📍 simulator.py:84

**当前状态**：基础框架
```python
class RoundManager:
    def __init__(self):
        self.current_round = 1
    
    def nextRound(self):
        self.current_round += 1
```

**功能说明**：
- 管理战斗回合流程
- 处理回合开始/结束事件
- 更新Buff持续时间
- 处理技能冷却

**重要性**：⭐⭐⭐⭐（中高优先级）
- Buff系统需要回合计数
- 技能冷却需要回合管理
- 能量恢复机制依赖回合

**需要实现**：
- 回合事件触发（利用现有EventManager）
- Buff时长更新
- 技能冷却倒计时
- DoT（持续伤害）处理

---

### 4. 技能系统 📍 util.py:99

**当前状态**：空类实现
```python
class Skill:
    pass
```

**功能说明**：
- 实现主动技能和被动技能
- 当前战斗只有普通攻击，需要技能系统丰富战斗

**重要性**：⭐⭐⭐⭐⭐（高优先级）
- 开发路线图中"更多角色和技能"的核心
- 极大增强战斗可玩性

**需要实现**：
1. **技能属性**：ID、名称、类型、冷却、能量消耗
2. **技能效果**：伤害、治疗、Buff/Debuff、控制
3. **触发机制**：手动/被动/条件触发
4. **与事件系统集成**：利用EventManager

**相关已有系统**：
- 能量系统（Character已有energy属性）
- 伤害系统（已有Damage类）
- Buff系统（已有Buff类）

---

## 三、开发路线图中的待办项

来自 README.md：

### 已完成 ✅
- [x] 基础战斗模拟器
- [x] 角色系统
- [x] 网格系统
- [x] 事件管理器

### 待完成 ⏳
- [ ] **UI 界面开发**
- [ ] **更多角色和技能**（依赖技能系统）
- [ ] **羁绊系统完善**（依赖属性更新系统）
- [ ] **装备系统**

---

## 四、功能模块依赖关系图

```
┌─────────────┐
│ 技能系统    │ ← 最高优先级，让战斗有趣
└──────┬──────┘
       │ 依赖
       ↓
┌─────────────┐     ┌─────────────┐
│ 回合管理器  │────→│ Buff系统    │
└─────────────┘     └─────────────┘
       │                    │
       │ 依赖               │ 依赖
       ↓                    ↓
┌─────────────────────────────┐
│    角色属性更新系统          │
└──────────────┬──────────────┘
               │ 依赖
               ↓
       ┌───────────────┐
       │  装备系统     │
       └───────────────┘
```

---

## 五、已有的良好基础（无需TODO）

项目已经建立了扎实的基础架构：

### 核心系统 ✅
1. **事件管理器（EventManager）**
   - 支持装饰器注册：`@em.on('event_name')`
   - 事件广播机制
   - 为技能、Buff等系统预留了扩展空间

2. **角色系统（Character）**
   - 完善的属性管理（基础属性 + 游戏内属性）
   - 位置管理（前中后排）
   - Buff容器
   - 装备槽预留

3. **战斗系统**
   - 网格布局（GameGrid, GameBoard）
   - 智能目标选择（基于仇恨值矩阵）
   - 攻击与反击机制
   - 伤害计算（Damage类）

4. **配置系统**
   - JSON角色配置
   - CSV/Excel转JSON工具
   - 可扩展的配置结构

5. **日志系统（Log）**
   - 彩色终端输出（Rich库）
   - 文件日志保存
   - 时间戳记录

### Buff系统框架 ✅
已有 Buff 类基本结构：
```python
class Buff:
    def __init__(self, inflicator, bearer, name, duration, effect):
        self.inflicator = inflicator  # 施加者
        self.bearer = bearer          # 承受者
        self.name = name
        self.duration = duration      # 持续回合数
        self.effect = effect          # 效果描述
```

---

## 六、开发优先级建议

### 阶段一：核心玩法（1-2周）
1. **技能系统**（优先级：⭐⭐⭐⭐⭐）
   - 让战斗从"互A"变得有策略性
   - 可以先实现3-5个示例技能

2. **回合管理器**（优先级：⭐⭐⭐⭐）
   - 完善战斗流程
   - 让Buff和技能冷却能正常工作

3. **角色属性更新**（优先级：⭐⭐⭐⭐⭐）
   - 让Buff效果能真正影响角色
   - 为装备系统打基础

### 阶段二：系统扩展（2-3周）
4. **装备系统**（优先级：⭐⭐⭐⭐）
   - 增加角色可定制性
   - 提升策略深度

5. **羁绊系统完善**
   - 基于属性更新系统
   - 增加组队策略

6. **更多角色和技能**
   - 丰富游戏内容

### 阶段三：体验优化（时间待定）
7. **UI界面开发**
   - 提升用户体验
   - 可以先做简单的Pygame界面

---

## 七、技术要点

### 使用的技术栈
- **Python 3.x** - 主要开发语言
- **Pygame** - 游戏渲染和精灵管理
- **Rich** - 终端美化输出
- **JSON** - 配置文件格式

### 设计模式
- **事件驱动** - EventManager提供事件机制
- **数据驱动** - JSON配置角色数据
- **装饰器模式** - 事件监听器注册

---

## 八、快速开始

### 运行战斗模拟器
```bash
cd 自走棋策划/py灰盒
python main.py
```

### 添加新角色
编辑 `character_config.json`：
```json
{
  "0001": {
    "id": "0001",
    "name": "角色名",
    "attack_power": 10,
    "health_points": 100,
    "speed": 5,
    "hate_value": 1,
    "hate_matrix": [[1,1,1],[1,1,1],[1,1,1]]
  }
}
```

### 数据转换
```bash
python emphrase_csv_2_json.py
```

---

## 九、总结

### 当前状态
- ✅ **可运行**：基础战斗模拟已经可以正常工作
- ⚠️ **功能有限**：只有普通攻击，缺少技能系统
- 🔧 **架构良好**：已有事件管理、日志、配置等基础设施

### 核心缺失
代码中共有 **4个 TODO**，按重要性排序：
1. 技能系统（Skill类）
2. 角色属性更新（updateInGameAttrs方法）
3. 装备系统（Equipment类）
4. 回合管理器（RoundManager类）

### 下一步建议
建议按照"技能系统 → 回合管理器 → 属性更新 → 装备系统"的顺序开发，可以让游戏快速变得好玩，同时保持良好的代码结构。

---

**文档版本**: v1.0  
**更新日期**: 2026-01-04  
**维护者**: GitHub Copilot
